<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚ ì”¨ ì •ë³´ ì•±</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸŒ¤ï¸ ë‚ ì”¨ ì •ë³´</h1>
            <p class="subtitle">í˜„ì¬ ìœ„ì¹˜ì˜ ì‹¤ì‹œê°„ ë‚ ì”¨ë¥¼ í™•ì¸í•˜ì„¸ìš”</p>
        </header>

        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...</p>
        </div>

        <div id="error" class="error" style="display: none;">
            <p id="error-message"></p>
            <button onclick="getWeather()" class="retry-btn">ë‹¤ì‹œ ì‹œë„</button>
        </div>

        <div id="weather-content" style="display: none;">
            <!-- ìœ„ì¹˜ ì •ë³´ -->
            <div class="location-box">
                <h2 id="location">-</h2>
                <p id="current-time">-</p>
            </div>

            <!-- ë©”ì¸ ë‚ ì”¨ ì •ë³´ -->
            <div class="main-weather">
                <div class="weather-icon-box">
                    <img id="weather-icon" src="" alt="ë‚ ì”¨ ì•„ì´ì½˜">
                </div>
                <div class="temp-box">
                    <h1 id="temperature">-</h1>
                    <p id="description">-</p>
                </div>
            </div>

            <!-- ìƒì„¸ ì •ë³´ ê·¸ë¦¬ë“œ -->
            <div class="details-grid">
                <div class="detail-card">
                    <div class="detail-icon">ğŸŒ¡ï¸</div>
                    <div class="detail-info">
                        <p class="detail-label">ì²´ê° ì˜¨ë„</p>
                        <p class="detail-value" id="feels-like">-</p>
                    </div>
                </div>

                <div class="detail-card">
                    <div class="detail-icon">ğŸ’§</div>
                    <div class="detail-info">
                        <p class="detail-label">ìŠµë„</p>
                        <p class="detail-value" id="humidity">-</p>
                    </div>
                </div>

                <div class="detail-card">
                    <div class="detail-icon">ğŸ’¨</div>
                    <div class="detail-info">
                        <p class="detail-label">í’ì†</p>
                        <p class="detail-value" id="wind-speed">-</p>
                    </div>
                </div>

                <div class="detail-card">
                    <div class="detail-icon">â˜ï¸</div>
                    <div class="detail-info">
                        <p class="detail-label">êµ¬ë¦„ëŸ‰</p>
                        <p class="detail-value" id="clouds">-</p>
                    </div>
                </div>

                <div class="detail-card">
                    <div class="detail-icon">ğŸŒ§ï¸</div>
                    <div class="detail-info">
                        <p class="detail-label">ê°•ìˆ˜ëŸ‰ (1ì‹œê°„)</p>
                        <p class="detail-value" id="rain">-</p>
                    </div>
                </div>

                <div class="detail-card">
                    <div class="detail-icon">ğŸ‘ï¸</div>
                    <div class="detail-info">
                        <p class="detail-label">ê°€ì‹œê±°ë¦¬</p>
                        <p class="detail-value" id="visibility">-</p>
                    </div>
                </div>

                <div class="detail-card">
                    <div class="detail-icon">ğŸŒ¡ï¸</div>
                    <div class="detail-info">
                        <p class="detail-label">ìµœì € / ìµœê³ </p>
                        <p class="detail-value" id="temp-range">-</p>
                    </div>
                </div>

                <div class="detail-card">
                    <div class="detail-icon">ğŸšï¸</div>
                    <div class="detail-info">
                        <p class="detail-label">ê¸°ì••</p>
                        <p class="detail-value" id="pressure">-</p>
                    </div>
                </div>
            </div>

            <!-- ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ -->
            <button onclick="getWeather()" class="refresh-btn">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        </div>
    </div>

    <script>
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ ë‚ ì”¨ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        window.addEventListener('load', getWeather);

        function getWeather() {
            const loading = document.getElementById('loading');
            const error = document.getElementById('error');
            const content = document.getElementById('weather-content');

            // UI ì´ˆê¸°í™”
            loading.style.display = 'block';
            error.style.display = 'none';
            content.style.display = 'none';

            // ë¸Œë¼ìš°ì €ì˜ Geolocation APIë¡œ í˜„ì¬ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
            if (!navigator.geolocation) {
                showError('ë¸Œë¼ìš°ì €ê°€ ìœ„ì¹˜ ì •ë³´ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                return;
            }

            navigator.geolocation.getCurrentPosition(
                // ì„±ê³µ ì‹œ
                (position) => {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    fetchWeatherData(lat, lon);
                },
                // ì‹¤íŒ¨ ì‹œ
                (err) => {
                    showError('ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ìœ„ì¹˜ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.');
                }
            );
        }

        function fetchWeatherData(lat, lon) {
            // ì„œë²„ì˜ ë‚ ì”¨ API í˜¸ì¶œ
            fetch(`/api/weather?lat=${lat}&lon=${lon}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('ë‚ ì”¨ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.error) {
                        throw new Error(data.error);
                    }
                    displayWeather(data);
                })
                .catch(err => {
                    showError(err.message);
                });
        }

        function displayWeather(data) {
            // í˜„ì¬ ì‹œê°„ í‘œì‹œ
            const now = new Date();
            const timeString = now.toLocaleString('ko-KR', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });

            // ë°ì´í„° í‘œì‹œ
            document.getElementById('location').textContent = data.location;
            document.getElementById('current-time').textContent = timeString;
            document.getElementById('weather-icon').src = `https://openweathermap.org/img/wn/${data.icon}@4x.png`;
            document.getElementById('temperature').textContent = `${data.temp}Â°C`;
            document.getElementById('description').textContent = data.description;
            document.getElementById('feels-like').textContent = `${data.feels_like}Â°C`;
            document.getElementById('humidity').textContent = `${data.humidity}%`;
            document.getElementById('wind-speed').textContent = `${data.wind_speed} m/s`;
            document.getElementById('clouds').textContent = `${data.clouds}%`;
            document.getElementById('rain').textContent = data.rain > 0 ? `${data.rain} mm` : 'ì—†ìŒ';
            document.getElementById('visibility').textContent = `${data.visibility} km`;
            document.getElementById('temp-range').textContent = `${data.temp_min}Â°C / ${data.temp_max}Â°C`;
            document.getElementById('pressure').textContent = `${data.pressure} hPa`;

            // UI í‘œì‹œ
            document.getElementById('loading').style.display = 'none';
            document.getElementById('weather-content').style.display = 'block';
        }

        function showError(message) {
            document.getElementById('error-message').textContent = message;
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error').style.display = 'block';
        }
    </script>
</body>
</html>
